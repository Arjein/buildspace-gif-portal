{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nconst idl_1 = require(\"../../coder/borsh/idl\");\nconst base64_1 = require(\"../../utils/bytes/base64\");\nclass ViewFactory {\n  static build(programId, idlIx, simulateFn, idl) {\n    const isMut = idlIx.accounts.find(a => a.isMut);\n    const hasReturn = !!idlIx.returns;\n    if (isMut || !hasReturn) return;\n    const view = async function () {\n      var _a, _b;\n      let simulationResult = await simulateFn(...arguments);\n      const returnPrefix = `Program return: ${programId} `;\n      let returnLog = simulationResult.raw.find(l => l.startsWith(returnPrefix));\n      if (!returnLog) {\n        throw new Error(\"View expected return log\");\n      }\n      let returnData = (0, base64_1.decode)(returnLog.slice(returnPrefix.length));\n      let returnType = idlIx.returns;\n      if (!returnType) {\n        throw new Error(\"View expected return type\");\n      }\n      const coder = idl_1.IdlCoder.fieldLayout({\n        type: returnType\n      }, Array.from([...((_a = idl.accounts) !== null && _a !== void 0 ? _a : []), ...((_b = idl.types) !== null && _b !== void 0 ? _b : [])]));\n      return coder.decode(returnData);\n    };\n    return view;\n  }\n}\nexports.default = ViewFactory;","map":{"version":3,"mappings":";;;;;AAQA;AACA;AAEA,MAAqBA,WAAW;EACvB,OAAOC,KAAK,CACjBC,SAAoB,EACpBC,KAA2B,EAC3BC,UAA2B,EAC3BC,GAAQ;IAER,MAAMC,KAAK,GAAGH,KAAK,CAACI,QAAQ,CAACC,IAAI,CAAEC,CAAa,IAAKA,CAAC,CAACH,KAAK,CAAC;IAC7D,MAAMI,SAAS,GAAG,CAAC,CAACP,KAAK,CAACQ,OAAO;IACjC,IAAIL,KAAK,IAAI,CAACI,SAAS,EAAE;IAEzB,MAAME,IAAI,GAAgB,kBAAkB;;MAC1C,IAAIC,gBAAgB,GAAG,MAAMT,UAAU,CAAC,YAAO,CAAC;MAChD,MAAMU,YAAY,GAAG,mBAAmBZ,SAAS,GAAG;MACpD,IAAIa,SAAS,GAAGF,gBAAgB,CAACG,GAAG,CAACR,IAAI,CAAES,CAAC,IAC1CA,CAAC,CAACC,UAAU,CAACJ,YAAY,CAAC,CAC3B;MACD,IAAI,CAACC,SAAS,EAAE;QACd,MAAM,IAAII,KAAK,CAAC,0BAA0B,CAAC;;MAE7C,IAAIC,UAAU,GAAG,mBAAM,EAACL,SAAS,CAACM,KAAK,CAACP,YAAY,CAACQ,MAAM,CAAC,CAAC;MAC7D,IAAIC,UAAU,GAAGpB,KAAK,CAACQ,OAAO;MAC9B,IAAI,CAACY,UAAU,EAAE;QACf,MAAM,IAAIJ,KAAK,CAAC,2BAA2B,CAAC;;MAE9C,MAAMK,KAAK,GAAGC,cAAQ,CAACC,WAAW,CAChC;QAAEC,IAAI,EAAEJ;MAAU,CAAE,EACpBK,KAAK,CAACC,IAAI,CAAC,CAAC,IAAI,SAAG,CAACtB,QAAQ,mCAAI,EAAE,CAAC,EAAE,IAAI,SAAG,CAACuB,KAAK,mCAAI,EAAE,CAAC,CAAC,CAAC,CAC5D;MACD,OAAON,KAAK,CAACO,MAAM,CAACX,UAAU,CAAC;IACjC,CAAC;IACD,OAAOR,IAAI;EACb;;AAhCFoB","names":["ViewFactory","build","programId","idlIx","simulateFn","idl","isMut","accounts","find","a","hasReturn","returns","view","simulationResult","returnPrefix","returnLog","raw","l","startsWith","Error","returnData","slice","length","returnType","coder","idl_1","fieldLayout","type","Array","from","types","decode","exports"],"sourceRoot":"","sources":["../../../../src/program/namespace/views.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"script"}