{"ast":null,"code":"import { splitArgsAndCtx } from \"../context\";\nimport { EventParser } from \"../event\";\nimport { ProgramError } from \"../../error\";\nexport default class SimulateFactory {\n  static build(idlIx, txFn, idlErrors, provider, coder, programId, idl) {\n    const simulate = async function () {\n      for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n        args[_key] = arguments[_key];\n      }\n      const tx = txFn(...args);\n      const [, ctx] = splitArgsAndCtx(idlIx, [...args]);\n      let resp = undefined;\n      try {\n        resp = await provider.simulate(tx, ctx.signers, ctx.options);\n      } catch (err) {\n        console.log(\"Translating error\", err);\n        let translatedErr = ProgramError.parse(err, idlErrors);\n        if (translatedErr === null) {\n          throw err;\n        }\n        throw translatedErr;\n      }\n      if (resp === undefined) {\n        throw new Error(\"Unable to simulate transaction\");\n      }\n      if (resp.value.err) {\n        throw new Error(`Simulate error: ${resp.value.err.toString()}`);\n      }\n      const logs = resp.value.logs;\n      if (!logs) {\n        throw new Error(\"Simulated logs not found\");\n      }\n      const events = [];\n      if (idl.events) {\n        let parser = new EventParser(programId, coder);\n        parser.parseLogs(logs, event => {\n          events.push(event);\n        });\n      }\n      return {\n        events,\n        raw: logs\n      };\n    };\n    return simulate;\n  }\n}","map":{"version":3,"mappings":"AAMA,SAASA,eAAe,QAAQ,YAAY;AAE5C,SAASC,WAAW,QAAe,UAAU;AAG7C,SAASC,YAAY,QAAQ,aAAa;AAQ1C,eAAc,MAAOC,eAAe;EAC3B,OAAOC,KAAK,CACjBC,KAA2B,EAC3BC,IAAwB,EACxBC,SAA8B,EAC9BC,QAAkB,EAClBC,KAAY,EACZC,SAAoB,EACpBC,GAAQ;IAER,MAAMC,QAAQ,GAAoB,kBAAkB;MAAA,kCAARC,IAAI;QAAJA,IAAI;MAAA;MAC9C,MAAMC,EAAE,GAAGR,IAAI,CAAC,GAAGO,IAAI,CAAC;MACxB,MAAM,GAAGE,GAAG,CAAC,GAAGf,eAAe,CAACK,KAAK,EAAE,CAAC,GAAGQ,IAAI,CAAC,CAAC;MACjD,IAAIG,IAAI,GAEQC,SAAS;MACzB,IAAI;QACFD,IAAI,GAAG,MAAMR,QAAS,CAACI,QAAQ,CAACE,EAAE,EAAEC,GAAG,CAACG,OAAO,EAAEH,GAAG,CAACI,OAAO,CAAC;OAC9D,CAAC,OAAOC,GAAG,EAAE;QACZC,OAAO,CAACC,GAAG,CAAC,mBAAmB,EAAEF,GAAG,CAAC;QACrC,IAAIG,aAAa,GAAGrB,YAAY,CAACsB,KAAK,CAACJ,GAAG,EAAEb,SAAS,CAAC;QACtD,IAAIgB,aAAa,KAAK,IAAI,EAAE;UAC1B,MAAMH,GAAG;;QAEX,MAAMG,aAAa;;MAErB,IAAIP,IAAI,KAAKC,SAAS,EAAE;QACtB,MAAM,IAAIQ,KAAK,CAAC,gCAAgC,CAAC;;MAEnD,IAAIT,IAAI,CAACU,KAAK,CAACN,GAAG,EAAE;QAClB,MAAM,IAAIK,KAAK,CAAC,mBAAmBT,IAAI,CAACU,KAAK,CAACN,GAAG,CAACO,QAAQ,EAAE,EAAE,CAAC;;MAEjE,MAAMC,IAAI,GAAGZ,IAAI,CAACU,KAAK,CAACE,IAAI;MAC5B,IAAI,CAACA,IAAI,EAAE;QACT,MAAM,IAAIH,KAAK,CAAC,0BAA0B,CAAC;;MAG7C,MAAMI,MAAM,GAAqC,EAAE;MACnD,IAAIlB,GAAG,CAACkB,MAAM,EAAE;QACd,IAAIC,MAAM,GAAG,IAAI7B,WAAW,CAACS,SAAS,EAAED,KAAK,CAAC;QAC9CqB,MAAM,CAACC,SAAS,CAACH,IAAI,EAAGI,KAAK,IAAI;UAC/BH,MAAM,CAACI,IAAI,CAACD,KAAK,CAAC;QACpB,CAAC,CAAC;;MAEJ,OAAO;QAAEH,MAAM;QAAEK,GAAG,EAAEN;MAAI,CAAE;IAC9B,CAAC;IAED,OAAOhB,QAAQ;EACjB","names":["splitArgsAndCtx","EventParser","ProgramError","SimulateFactory","build","idlIx","txFn","idlErrors","provider","coder","programId","idl","simulate","args","tx","ctx","resp","undefined","signers","options","err","console","log","translatedErr","parse","Error","value","toString","logs","events","parser","parseLogs","event","push","raw"],"sourceRoot":"","sources":["../../../../src/program/namespace/simulate.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}