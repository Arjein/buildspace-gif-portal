{"ast":null,"code":"\"use strict\";\n\nvar __createBinding = this && this.__createBinding || (Object.create ? function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  var desc = Object.getOwnPropertyDescriptor(m, k);\n  if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n    desc = {\n      enumerable: true,\n      get: function () {\n        return m[k];\n      }\n    };\n  }\n  Object.defineProperty(o, k2, desc);\n} : function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  o[k2] = m[k];\n});\nvar __setModuleDefault = this && this.__setModuleDefault || (Object.create ? function (o, v) {\n  Object.defineProperty(o, \"default\", {\n    enumerable: true,\n    value: v\n  });\n} : function (o, v) {\n  o[\"default\"] = v;\n});\nvar __importStar = this && this.__importStar || function (mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n  __setModuleDefault(result, mod);\n  return result;\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.stateDiscriminator = exports.BorshStateCoder = void 0;\nconst buffer_1 = require(\"buffer\");\nconst js_sha256_1 = require(\"js-sha256\");\nconst idl_js_1 = require(\"./idl.js\");\nconst features = __importStar(require(\"../../utils/features.js\"));\nclass BorshStateCoder {\n  constructor(idl) {\n    if (idl.state === undefined) {\n      throw new Error(\"Idl state not defined.\");\n    }\n    this.layout = idl_js_1.IdlCoder.typeDefLayout(idl.state.struct, idl.types);\n  }\n  async encode(name, account) {\n    const buffer = buffer_1.Buffer.alloc(1000); // TODO: use a tighter buffer.\n    const len = this.layout.encode(account, buffer);\n    const disc = await stateDiscriminator(name);\n    const accData = buffer.slice(0, len);\n    return buffer_1.Buffer.concat([disc, accData]);\n  }\n  decode(ix) {\n    // Chop off discriminator.\n    const data = ix.slice(8);\n    return this.layout.decode(data);\n  }\n}\nexports.BorshStateCoder = BorshStateCoder;\n// Calculates unique 8 byte discriminator prepended to all anchor state accounts.\nasync function stateDiscriminator(name) {\n  let ns = features.isSet(\"anchor-deprecated-state\") ? \"account\" : \"state\";\n  return buffer_1.Buffer.from(js_sha256_1.sha256.digest(`${ns}:${name}`)).slice(0, 8);\n}\nexports.stateDiscriminator = stateDiscriminator;","map":{"version":3,"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAEA;AAEA;AACA;AAEA,MAAaA,eAAe;EAG1BC,YAAmBC,GAAQ;IACzB,IAAIA,GAAG,CAACC,KAAK,KAAKC,SAAS,EAAE;MAC3B,MAAM,IAAIC,KAAK,CAAC,wBAAwB,CAAC;;IAE3C,IAAI,CAACC,MAAM,GAAGC,iBAAQ,CAACC,aAAa,CAACN,GAAG,CAACC,KAAK,CAACM,MAAM,EAAEP,GAAG,CAACQ,KAAK,CAAC;EACnE;EAEO,MAAMC,MAAM,CAAUC,IAAY,EAAEC,OAAU;IACnD,MAAMC,MAAM,GAAGC,eAAM,CAACC,KAAK,CAAC,IAAI,CAAC,CAAC,CAAC;IACnC,MAAMC,GAAG,GAAG,IAAI,CAACX,MAAM,CAACK,MAAM,CAACE,OAAO,EAAEC,MAAM,CAAC;IAE/C,MAAMI,IAAI,GAAG,MAAMC,kBAAkB,CAACP,IAAI,CAAC;IAC3C,MAAMQ,OAAO,GAAGN,MAAM,CAACO,KAAK,CAAC,CAAC,EAAEJ,GAAG,CAAC;IAEpC,OAAOF,eAAM,CAACO,MAAM,CAAC,CAACJ,IAAI,EAAEE,OAAO,CAAC,CAAC;EACvC;EAEOG,MAAM,CAAUC,EAAU;IAC/B;IACA,MAAMC,IAAI,GAAGD,EAAE,CAACH,KAAK,CAAC,CAAC,CAAC;IACxB,OAAO,IAAI,CAACf,MAAM,CAACiB,MAAM,CAACE,IAAI,CAAC;EACjC;;AAxBFC;AA2BA;AACO,eAAeP,kBAAkB,CAACP,IAAY;EACnD,IAAIe,EAAE,GAAGC,QAAQ,CAACC,KAAK,CAAC,yBAAyB,CAAC,GAAG,SAAS,GAAG,OAAO;EACxE,OAAOd,eAAM,CAACe,IAAI,CAACC,kBAAM,CAACC,MAAM,CAAC,GAAGL,EAAE,IAAIf,IAAI,EAAE,CAAC,CAAC,CAACS,KAAK,CAAC,CAAC,EAAE,CAAC,CAAC;AAChE;AAHAK","names":["BorshStateCoder","constructor","idl","state","undefined","Error","layout","idl_js_1","typeDefLayout","struct","types","encode","name","account","buffer","buffer_1","alloc","len","disc","stateDiscriminator","accData","slice","concat","decode","ix","data","exports","ns","features","isSet","from","js_sha256_1","digest"],"sourceRoot":"","sources":["../../../../src/coder/borsh/state.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"script"}